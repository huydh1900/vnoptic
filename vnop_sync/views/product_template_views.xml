<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="product_template_form_inherit_product" model="ir.ui.view">
        <field name="name">product.template.form.inherit.product</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
            
            <!-- Add hidden computed fields for UI logic -->
            <xpath expr="//div[@class='oe_title']" position="after">
                <field name="is_lens" invisible="1"/>
                <field name="is_opt" invisible="1"/>
            </xpath>
            
            <!-- Removed product_type selection from header -->
            
            <!-- Add Product General Info Section -->
            <xpath expr="//sheet/notebook/page[@name='general_information']/group" position="before">
                <group string="Phân loại sản phẩm">
                    <group>
                        <field name="categ_id" string="Danh mục sản phẩm" options="{'no_create': True}"/>
                        <field name="group_id" invisible="1"/>
                        <field name="brand_id"/>
                        <field name="warranty_id" options="{'no_create': True}"/>
                        <field name="index_id" options="{'no_create': True}" 
                                invisible="not is_lens"/>
                    </group>
                    <group>
                        <field name="x_eng_name"/>
                        <field name="x_trade_name"/>
                        <field name="status_product_id" options="{'no_create': True}"/>
                        <field name="auto_generate_code"/>
                        <field name="default_code" readonly="auto_generate_code == True" invisible="1"/>
                    </group>
                </group>
            </xpath>
            
            <!-- Add custom tabs to notebook -->
            <xpath expr="//notebook" position="inside">
                
                <!-- Tab: Lens Design (New Config-Driven) -->
                <page string="Thông số &amp; Thiết kế Lens" name="product_lens_design"
                      invisible="0">
                    <field name="lens_ids" nolabel="1" context="{'default_product_tmpl_id': id}">
                        <list editable="bottom" create="1" delete="1">
                            <field name="sph_id" string="SPH" options="{'no_create': True}" optional="show"/>
                            <field name="cyl_id" string="CYL" options="{'no_create': True}" optional="show"/>
                            <field name="axis" string="Axis" optional="show"/>
                            <field name="lens_add" string="Lens Add" optional="show"/>
                            <field name="diameter" string="Diameter" optional="show"/>
                            <field name="base_curve" string="Base" optional="hide"/>
                            <field name="design_id" string="Thiết kế" options="{'no_create': True}" optional="show"/>
                            <field name="index_id" string="Chiết suất" options="{'no_create': True}" optional="show"/>
                            <field name="material_id" string="Chất liệu" options="{'no_create': True}" optional="show"/>
                            <field name="feature_ids" string="Tích hợp/Coating" widget="many2many_tags" options="{'no_create': True}" optional="show"/>
                            <field name="prism" string="Prism" optional="hide"/>
                        </list>
                        <form>
                            <sheet>
                                <group>
                                    <group string="Thông số quang học">
                                        <field name="sph_id" options="{'no_create': True}"/>
                                        <field name="cyl_id" options="{'no_create': True}"/>
                                        <field name="axis"/>
                                        <field name="lens_add"/>
                                        <field name="diameter"/>
                                        <field name="base_curve"/>
                                        <field name="prism"/>
                                    </group>
                                    <group string="Thiết kế, Chiết suất &amp; Chất liệu">
                                        <field name="design_id" string="Thiết kế" options="{'no_create': True}"/>
                                        <field name="index_id" string="Chiết suất" options="{'no_create': True}"/>
                                        <field name="material_id" string="Chất liệu" options="{'no_create': True}"/>
                                        <field name="feature_ids" string="Tích hợp/Coating" widget="many2many_tags" options="{'no_create': True}"/>
                                    </group>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </page>
                
                <!-- Tab: Optical Info (only visible when product_type = opt) -->
                <page string="Thông tin Gọng" name="product_opt_info"
                      invisible="product_type != 'opt'">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': id}">
                        <list editable="bottom" create="1" delete="1">
                            <field name="season"/>
                            <field name="sku"/>
                            <field name="model"/>
                            <field name="serial"/>
                            <field name="color"/>
                            <field name="oem_ncc"/>
                        </list>
                    </field>
                </page>
                
                <!-- Tab: Optical Design -->
                <page string="Thiết kế Gọng" name="product_opt_design"
                      invisible="not is_opt">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': id}" mode="list">
                        <list editable="bottom">
                            <field name="frame_id" options="{'no_create': True}"/>
                            <field name="gender"/>
                            <field name="frame_type_id" options="{'no_create': True}"/>
                            <field name="ve_id" options="{'no_create': True}"/>
                            <field name="shape_id" options="{'no_create': True}"/>
                            <field name="temple_id" options="{'no_create': True}"/>
                        </list>
                    </field>
                </page>
                
                <!-- Tab: Optical Material -->
                <page string="Chất liệu Gọng" name="product_opt_material"
                      invisible="not is_opt">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': id}" mode="list">
                        <list editable="bottom">
                            <field name="materials_front_ids" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="materials_temple_ids" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="material_temple_tip_id" options="{'no_create': True}"/>
                            <field name="material_lens_id" options="{'no_create': True}"/>
                            <field name="material_ve_id" options="{'no_create': True}"/>
                            <field name="coating_ids" widget="many2many_tags" options="{'no_create': True}"/>
                        </list>
                    </field>
                </page>
                
                <!-- Tab: Optical Color -->
                <page string="Màu sắc Gọng" name="product_opt_color"
                      invisible="not is_opt">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': id}" mode="list">
                        <list editable="bottom">
                            <field name="color_front_id" options="{'no_create': True}"/>
                            <field name="color_temple_id" options="{'no_create': True}"/>
                            <field name="color_lens_id" options="{'no_create': True}"/>
                        </list>
                    </field>
                </page>
                
                <!-- Tab: Optical Size -->
                <page string="Kích thước Gọng" name="product_opt_size"
                      invisible="not is_opt">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': id}" mode="list">
                        <list editable="bottom">
                            <field name="temple_width"/>
                            <field name="lens_width"/>
                            <field name="bridge_width"/>
                            <field name="lens_height"/>
                            <field name="lens_span"/>
                        </list>
                    </field>
                </page>
                
            </xpath>
        </field>
    </record>

</odoo>
